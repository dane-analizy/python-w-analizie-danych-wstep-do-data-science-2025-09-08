# 5. Pandas - filtrowanie i transformacje

## Filtrowanie w Pandas  

Filtrowanie umożliwia wybieranie z DataFrame tylko tych wierszy, które spełniają określone warunki. Pandas oferuje kilka metod filtrowania, każda z nich jest przydatna w różnych sytuacjach, np. gdy chcemy odwołać się do danych po etykietach, pozycjach, lub wyrażeń warunkowych.  

Przykładowy DataFrame do filtracji (na bazie poprzedniego):  

```python
import pandas as pd

df = pd.DataFrame({
    'Imie': ['Jan', 'Anna', 'Piotr', 'Maria', 'Krzysztof'],
    'Wiek': [28, 34, 26, 40, 22],
    'Miasto': ['Warszawa', 'Kraków', 'Gdańsk', 'Warszawa', 'Poznań'],
    'Pensja': [5000, 6200, 4800, 5200, 4500]
})
```

***

### `loc`  

Filtrowanie po etykietach indeksu i kolumn, daje możliwość selekcji za pomocą nazw i warunków.  

```python
# Wybierz osoby mieszkające w Warszawie
print(df.loc[df['Miasto'] == 'Warszawa'])
```

Zadanie: Wybierz osoby, których wiek jest większy niż 30 lat.

***

### `iloc`  

Filtrowanie na podstawie pozycji (indeksów liczbowych).  

```python
# Wybierz pierwsze 3 wiersze i 2 pierwsze kolumny
print(df.iloc[0:3, 0:2])
```

Zadanie: Wydrukuj drugą i trzecią osobę oraz ich imiona i wiek.

***

### `query`  

Filtrowanie z wykorzystaniem składni zapytania podobnej do SQL, ułatwia czytelność w przypadku skomplikowanych warunków.  

```python
print(df.query("Pensja > 4800 and Miasto == 'Warszawa'"))
```

Zadanie: Wypisz osoby, których wiek jest poniżej 30 i pensja powyżej 4500.

***

### `where`  

Zwraca DataFrame, gdzie warunek jest spełniony, a pozostałe wartości zastępuje np. NaN.  

```python
print(df.where(df['Wiek'] > 30))
```

Zadanie: Zastosuj `where`, by pozostawić tylko osoby z pensją powyżej 5000.

***

### `isin`  

Filtr pozwalający wybrać wartości, które zawierają się na liście możliwych wartości.  

```python
print(df[df['Miasto'].isin(['Warszawa','Kraków'])])
```

Zadanie: Wybierz osoby mieszkające w Warszawie lub Poznaniu.

***

### `isnull` i `notnull`  

Służą do wykrywania brakujących danych (NaN).  

```python
df.loc[df['Pensja'].isnull()]
```

Zadanie: Dodaj do kolumny 'Pensja' brakującą wartość dla ostatniego wiersza i wyświetl tylko te wiersze, gdzie pensja jest null.

***

## Wybór danych  

Po filtrowaniu często wybieramy konkretną kolumnę lub kolumny.  

```python
print(df.loc[df['Wiek'] > 30, ['Imie', 'Pensja']])
```

Zadanie: Wybierz imiona i miasta osób z pensją powyżej 4800.

***

## Sortowanie  

Sortowanie ułatwia analizę danych, np. po wielkości pensji lub alfabetycznie.  

```python
print(df.sort_values(by='Pensja', ascending=False))
```

Zadanie: Posortuj DataFrame według wieku rosnąco.

***

## Tworzenie nowych kolumn na podstawie istniejących  

Możemy tworzyć nowe kolumny, np. na podstawie warunków lub obliczeń.  

```python
df['Podatek'] = df['Pensja'] * 0.19
print(df)
```

Zadanie: Dodaj kolumnę 'Status', zawierającą wartość 'Młody' jeśli wiek < 30, w przeciwnym razie 'Doświadczony'.
