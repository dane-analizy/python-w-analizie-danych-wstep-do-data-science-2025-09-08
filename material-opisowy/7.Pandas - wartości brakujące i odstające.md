# 7. Pandas - wartości brakujące i odstające

## Jak rozpoznawać wartości brakujące (`isnull`)  

Wartości brakujące (NaN, None) to puste miejsca w danych, które trzeba rozpoznać i odpowiednio obsłużyć, aby uniknąć błędów w analizie. Metoda `isnull()` (alias `isna()`) zwraca maskę logiczną wskazującą, które wartości są brakujące.  

```python
import pandas as pd

data = {'Imie': ['Anna', 'Marcin', None, 'Julia'],
        'Wiek': [28, None, 35, 22]}
df = pd.DataFrame(data)

print(df.isnull())
```

**Zadanie:** Sprawdź, które pola w powyższym DataFrame są puste (NaN lub None).

***

## Wartości brakujące

### Uzupełnianie - `fillna`  

Możemy wypełnić braki wybraną wartością, np. zerem, tekstem lub inną liczbą.  

```python
df_filled = df.fillna({'Imie': 'Nieznane', 'Wiek': 0})

print(df_filled)
```

**Zadanie:** Uzupełnij brakujące imiona słowem 'Anonim', a wiek liczbą 30.

***

### Uzupełnianie średnią `transform`  

Często uzupełnia się braki średnią lub inną statystyką kolumny, aby zachować spójność danych.  

```python
mean_wiek = df['Wiek'].mean()
df['Wiek'] = df['Wiek'].fillna(mean_wiek)

print(df)
```

Przykład: jeśli mamy dodatkową kolumnę, np. 'Płeć', możemy uzupełnić braki w kolumnie 'Wiek' średnią wieku w obrębie każdej grupy płci:

```python
data = {'Imie': ['Anna', 'Marcin', None, 'Julia'],
    'Wiek': [28, None, 35, 22],
    'Płeć': ['K', 'M', 'M', 'K']}
df = pd.DataFrame(data)

df['Wiek'] = df.groupby('Płeć')['Wiek'].transform(lambda x: x.fillna(x.mean()))
print(df)
```

**Zadanie:** Uzupełnij braki w kolumnie 'Wiek' średnią wieku (połącz to z metodą `transform` grupując np. według płci, jeśli jest dostępna).

***

### Usuwanie - `dropna`  

Można też po prostu usunąć wiersze lub kolumny z brakującymi wartościami.  

```python
df_cleaned = df.dropna()

print(df_cleaned)
```

**Zadanie:** Usuń wszystkie wiersze, w których jest co najmniej jedna wartość brakująca.

***

## Identyfikacja wartości odstających  

Wartości odstające to takie, które znacząco różnią się od reszty danych i mogą wypaczać analizę. Ich identyfikacja polega zwykle na zastosowaniu metod opisowych (np. wartości poza kwartyli), lub statystycznych.  

Przykładowa prosta identyfikacja wartości odstających w kolumnie z użyciem IQR:  

```python
Q1 = df['Wiek'].quantile(0.25)
Q3 = df['Wiek'].quantile(0.75)
IQR = Q3 - Q1

outliers = df[(df['Wiek'] < (Q1 - 1.5 * IQR)) | (df['Wiek'] > (Q3 + 1.5 * IQR))]

print(outliers)
```

**Zadanie:** Znajdź i wyświetl wiersze z wartościami odstającymi w kolumnie 'Wiek' w podanym DataFrame.
